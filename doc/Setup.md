# Tree-sitter Zortex

A Tree-sitter parser for the Zortex markup language - an extended Markdown format with semantic linking and tagging.

## Features

- Article headers (`@@`) and tags (`@`)
- Extended link syntax for cross-referencing
- Standard Markdown features (headings, lists, code blocks)
- LaTeX math support
- Bold/italic formatting
- Nested list support with proper indentation

## Installation

### Prerequisites

```bash
npm install -g tree-sitter-cli
```

### Building

```bash
# Generate the parser
tree-sitter generate

# Run tests
tree-sitter test

# Test highlighting
tree-sitter highlight test.zortex
```

## Neovim Setup

### 1. Install the parser

Add to your Neovim config (using `nvim-treesitter`):

```lua
-- In your init.lua or wherever you configure nvim-treesitter
local parser_config = require "nvim-treesitter.parsers".get_parser_configs()

parser_config.zortex = {
  install_info = {
    url = "~/path/to/tree-sitter-zortex", -- local path or git repo
    files = {"src/parser.c", "src/scanner.c"},
    branch = "main",
  },
  filetype = "zortex",
}

-- Install it
vim.cmd [[:TSInstall zortex]]
```

### 2. Register the filetype

```lua
-- Add filetype detection
vim.filetype.add({
  extension = {
    zortex = "zortex",
    zx = "zortex",
  },
})
```

### 3. Set up highlighting

Create `~/.config/nvim/queries/zortex/highlights.scm` and copy the contents from `queries/highlights.scm`.

### 4. Optional: Vim syntax file fallback

If you want basic highlighting before Tree-sitter loads, create `~/.config/nvim/syntax/zortex.vim`:

````vim
" Basic Zortex syntax highlighting
if exists("b:current_syntax")
  finish
endif

" Article headers
syn match zortexArticleHeader "^@@.*$" contains=zortexArticleMarker
syn match zortexArticleMarker "^@@" contained

" Tags
syn match zortexTag "^@[^ ]*$" contains=zortexTagMarker
syn match zortexTagMarker "^@" contained

" Headings
syn match zortexHeading "^#\+.*$" contains=zortexHeadingMarker
syn match zortexHeadingMarker "^#\+" contained

" Labels
syn match zortexLabel "^[A-Za-z0-9 ]\+:$"

" Links
syn region zortexLink start="\[" end="\]" contains=zortexLinkText
syn match zortexURL "(.*)" contained

" Code
syn region zortexInlineCode start="`" end="`"
syn region zortexCodeBlock start="```" end="```"

" LaTeX
syn region zortexInlineMath start="\$" end="\$"
syn region zortexBlockMath start="\$\$" end="\$\$"

" Formatting
syn region zortexBold start="\*\*" end="\*\*"
syn region zortexItalic start="\*" end="\*"
syn region zortexBoldItalic start="\*\*\*" end="\*\*\*"

" Define colors
hi def link zortexArticleHeader Title
hi def link zortexArticleMarker Keyword
hi def link zortexTag Tag
hi def link zortexTagMarker Special
hi def link zortexHeading Title
hi def link zortexHeadingMarker Special
hi def link zortexLabel Identifier
hi def link zortexLink Underlined
hi def link zortexURL String
hi def link zortexInlineCode String
hi def link zortexCodeBlock String
hi def link zortexInlineMath Special
hi def link zortexBlockMath Special
hi def link zortexBold Bold
hi def link zortexItalic Italic
hi def link zortexBoldItalic Bold

let b:current_syntax = "zortex"
````

## Usage

### Testing the parser

```bash
# Run all tests
tree-sitter test

# Test specific file
tree-sitter parse test.zortex

# Test highlighting
tree-sitter highlight test.zortex
```

### File structure

```
tree-sitter-zortex/
├── grammar.js          # Grammar definition
├── src/
│   ├── scanner.c      # External scanner for indentation
│   └── parser.c       # Generated by tree-sitter
├── queries/
│   └── highlights.scm # Syntax highlighting queries
├── corpus/
│   └── test.txt      # Grammar tests
├── test.zortex       # Example file
├── package.json      # NPM configuration
└── README.md         # This file
```

## Grammar Overview

The Zortex format consists of:

1. **Article Headers**: `@@Article Name` - Required, can have multiple (aliases)
2. **Tags**: `@tag-name` - Optional, for categorization
3. **Content Blocks**: Standard Markdown with extensions
4. **Links**: Three types:
   - Article links: `[Article Name]`
   - Subpath links: `[Article/#Heading]`, `[Article/:Label]`
   - Standard Markdown: `[text](url)`
5. **Formatting**: Bold (`**`), italic (`*`), bold-italic (`***`)
6. **Math**: Inline (`$...$`) and block (`$$...$$`)

## License

MIT
